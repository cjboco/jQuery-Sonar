(function($,d,e,f){"use strict";$.fn.sonar=function(a,b){if(typeof a==="boolean"){b=a;a=f}return $.sonar(this[0],a,b)};var g=e.body,$win=$(d),onScreenEvent="scrollin",offScreenEvent="scrollout",detect=function(a){var b=$.extend({parent:null,elem:null,distance:0,full:false},a),parentElem,elemTop,bodyHeight,screenHeight,scrollTop,elemHeight;b.parent=b.parent||$win;if(b.elem){g=g||e.body;parentElem=b.elem;elemTop=0;bodyHeight=g.offsetHeight;screenHeight=b.parent.innerHeight||e.documentElement.clientHeight||g.clientHeight||0;scrollTop=e.documentElement.scrollTop||b.parent.pageYOffset||g.scrollTop||0;elemHeight=b.elem.offsetHeight||0;if(!b.elem.sonarElemTop||b.elem.sonarBodyHeight!==bodyHeight){if(parentElem.offsetParent){do{elemTop+=parentElem.offsetTop}while(parentElem=parentElem.offsetParent)}b.elem.sonarElemTop=elemTop;b.elem.sonarBodyHeight=bodyHeight}b.distance=b.distance||0;return(!(b.elem.sonarElemTop+(b.full?0:elemHeight)<scrollTop-b.distance)&&!(b.elem.sonarElemTop+(b.full?elemHeight:0)>scrollTop+screenHeight+b.distance))}},pollQueue={},pollActive=0,pollId,poll=function(){pollId&&window.clearTimeout(pollId);pollId=window.setTimeout(function(){var a,elems,screenEvent,options,detected,i,l;for(screenEvent in pollQueue){if(pollQueue.hasOwnProperty(screenEvent)){elems=pollQueue[screenEvent];for(i=0,l=elems.length;i<l;i++){options=elems[i];a=options.elem;detected=detect({parent:options.parent||null,elem:a||null,distance:options.px||0,full:options.full||false});if(screenEvent===offScreenEvent?!detected:detected){if(!options.tr){if(a['_'+screenEvent]){$(a).trigger(screenEvent);options.tr=1}else{elems.splice(i,1);i--;l--}}}else{options.tr=0}}}}},0)},removeSonar=function(a,b){a['_'+b]=0},addSonar=function(a,b){var c=b.px,full=b.full,screenEvent=b.evt,parent=d,detected=detect({parent:b.parent||null,elem:a||null,distance:b.px||0,full:b.full||false}),triggered=0;a['_'+screenEvent]=1;if(screenEvent===offScreenEvent?!detected:detected){window.setTimeout(function(){$(a).trigger(screenEvent===offScreenEvent?offScreenEvent:onScreenEvent)},0);triggered=1}pollQueue[screenEvent].push({parent:parent||null,elem:a||null,px:c||0,full:full||false,tr:triggered});if(!pollActive){$win.bind("scroll",poll);pollActive=1}};$.sonar=detect;pollQueue[onScreenEvent]=[];$.event.special[onScreenEvent]={add:function(a){var b=a.data||{},elem=this;if(!elem[onScreenEvent]){addSonar(this,{px:b.distance,full:b.full,evt:onScreenEvent})}},remove:function(a){removeSonar(this,onScreenEvent)}};pollQueue[offScreenEvent]=[];$.event.special[offScreenEvent]={add:function(a){var b=a.data||{},elem=this;if(!elem[offScreenEvent]){addSonar(elem,{px:b.distance,full:b.full,evt:offScreenEvent})}},remove:function(a){removeSonar(this,offScreenEvent)}}}(jQuery,window,document));